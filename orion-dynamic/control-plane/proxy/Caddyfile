{
    local_certs
    auto_https disable_redirects
}

# --- HTTPS local ---
https://localhost {
    tls internal

    # Reverse proxy pour toute l'API — ne pas utiliser handle_path !
    handle /api/* {
        reverse_proxy api:8080 {
            health_uri /api/health
            health_interval 10s
        }
    }

    # Réponse par défaut
    handle {
        respond "Orion-Dynamic - API via Caddy" 200
    }
}

# --- HTTP interne ---
:80 {
    handle /api/* {
        reverse_proxy api:8080 {
            health_uri /api/health
            health_interval 10s
        }
    }
}

